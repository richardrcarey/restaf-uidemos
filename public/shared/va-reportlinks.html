/*
 * va report viewer web component
 * Input is:
 *    image = link to image
 *    report = link to report
 *  Both are obtained from the VA UI's export menu
 *  This component is useful for a quick demo of embedded VA report with minimal programming.
 *  Not useful in a real world application
 *  Intended audience is sales team demoing our embedded report capability.
 */
<!--
  ~ Copyright (c) SAS Institute Inc.
  ~  Licensed under the Apache License, Version 2.0 (the "License");
  ~  you may not use this file except in compliance with the License.
  ~  You may obtain a copy of the License at
  ~
  ~  http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~  Unless required by applicable law or agreed to in writing, software
  ~  distributed under the License is distributed on an "AS IS" BASIS,
  ~  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~  See the License for the specific language governing permissions and
  ~  limitations under the License.
  ~
  ~
  -->

<template id="vaReportLinksTemplate">
    <style>
        .grid {
            display: table;
            width: calc(100% + 1.75rem);
            border-collapse: separate;
            border-spacing: 1rem;
            margin: -1rem;
        }
        .gridRow {
            display: table-row;
        }
        .gridCell {
            display: table-cell;
            width: 50%;
            padding-bottom: 50%;
            position: relative;
        }
        .component {
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            flex-flow: column;
        }
        .componentIframe {
            border: 1px solid #000000;
            margin-top: 0.5rem;
            flex: 1;
        }
        .componentHeader {
            height: 30px;
            width: 100%;
        }

    </style>

    <div class="grid">
        <div class="gridRow">
            <div class="gridCell">
                <div id="component1" class="component">
                    <div id="component1-header" class="componentHeader">
                        <input id="button" type="button" value="Go To Report Viewer..."/>
                    </div>
                    <iframe id="imageViewer" class="componentIframe"  style="display: none;"></iframe>
                    <iframe id="reportViewer" class="componentIframe" style="display: none;"></iframe>
                </div>
            </div>
        </div>
    </div>



</template>


<script>
    class vaReportLinks extends HTMLElement {

        constructor() {
            super();
        }

        static get observedAttributes() {
            return ['image', 'report'];
        };


        createdCallback() {
            debugger;
            this.shadow   = this.createShadowRoot();
            let localDoc  = ( document.currentScript ) ? document.currentScript.ownerDocument : vaReportLinksLocalDoc;
            let template  = localDoc.querySelector( '#vaReportLinksTemplate' );
            let clone     = document.importNode( template.content, true );
            this.shadow.appendChild( clone );
        }

        attachedCallback() {
            debugger;
            this.editButton      = ' ';
            this.reportLoaded    = false;
            this.imageLoaded     = false;
            this.swapViewer( 'image', 'report' );
            this.shadow.querySelector( "#button" ).onclick = this.loadFrame.bind( this );

        }

        detachedCallback() {
        }

        attributeChangedCallback(attributeName, oldValue, newValue) {
            debugger;
            console.log( attributeName );
            debugger;
            if ( attributeName === 'image' ) {
                this.imageLoaded  = false;
                this.reportLoaded = false;
                this.swapViewer( 'image', 'report');
            }
        }

        swapViewer( next, hide ){
            debugger;
            let nextSrc     = this.getAttribute( next );
            let nextElement = this.shadow.querySelector( `#${next}Viewer` );
            let hideElement = this.shadow.querySelector( `#${hide}Viewer` );
            this.shadow.querySelector( '#button' ).value = `Go To ${hide} Viewer...`;
            this.editButton = hide;
            nextElement.style.display = 'block';
            hideElement.style.display = 'none';
            let loaded = `${next}Loaded`;
            if ( this[loaded]  === false ){
                nextElement.setAttribute( 'src', nextSrc );
                this[loaded] = true;
            }
        }

        loadFrame() {
           if ( this.editButton === 'image' ) {
               this.swapViewer('image', 'report');
           } else {
               this.swapViewer( 'report', 'image' );
           }
        }

    }

    let evaReportLinks  = document.registerElement( "va-reportlinks", vaReportLinks );
    /*
     * Need this until imports are fully supported in browsers
     */
    let vaReportLinksLocalDoc = document.currentScript.ownerDocument;


</script>
